<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Graduate Descent - numerical</title><link href="https://timvieira.github.io/blog/" rel="alternate"></link><link href="/blog/feeds/tag/numerical.atom.xml" rel="self"></link><id>https://timvieira.github.io/blog/</id><updated>2021-03-25T00:00:00-04:00</updated><entry><title>Fast rank-one updates to matrix inverse?</title><link href="https://timvieira.github.io/blog/post/2021/03/25/fast-rank-one-updates-to-matrix-inverse/" rel="alternate"></link><published>2021-03-25T00:00:00-04:00</published><updated>2021-03-25T00:00:00-04:00</updated><author><name>Tim Vieira</name></author><id>tag:timvieira.github.io,2021-03-25:/blog/post/2021/03/25/fast-rank-one-updates-to-matrix-inverse/</id><content type="html">&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;The &lt;a href="https://en.wikipedia.org/wiki/Sherman%E2%80%93Morrison_formula"&gt;Shermanâ€“Morrison formula&lt;/a&gt; suggests a computational shortcut to update a matrix inverse subject to an additive change of the form $u \, v^\top$:&lt;/p&gt;
$$
(A + u \, v^\top)^{-1}
$$&lt;p&gt;Suppose we have precomputed $B = A^{-1}$, the shortcut is
$$
(A + u \, v^\top)^{-1} = B^{-1} - \frac{1}{1 + v^\top B\, u} B\, u\, v^\top B 
$$&lt;/p&gt;
&lt;p&gt;Implemented carefully, it runs in $\mathcal{O}(n^2)$, which is better than $\mathcal{O}(n^3)$ from scratch.  Ok, &lt;em&gt;technically&lt;/em&gt; matrix inversion can run faster than cubic, but you get my point.&lt;/p&gt;
&lt;p&gt;Below is a direct translation of equations into numpy, but It does NOT run in $\mathcal{O}(n^2)$.&lt;/p&gt;
&lt;p&gt;Do you see why?&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[1]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nn"&gt;scipy&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;numpy.linalg&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;inv&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;slowest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;inv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;outer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;slow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fast&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[2]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;arsenal&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;iterview&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timers&lt;/span&gt;
&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;timers&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;iterview&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logspace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;3.75&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
    &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ceil&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;inv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;slowest&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;slowest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;slow&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;slow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;fast&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fast&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    
    &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

    &lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_subarea output_stream output_stderr output_text"&gt;
&lt;pre&gt;100.0% (10/10) [======================================================] 00:00:23
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[3]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_feature&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

    &lt;div class="prompt"&gt;&lt;/div&gt;




&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,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
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[4]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compare&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

    &lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;fast is 11.1313x faster than slow (&lt;span class="ansi-yellow-fg"&gt;p=0.09294&lt;/span&gt;, mean: slow: 0.548586, fast: 0.0492832)
fast is 15.5816x faster than slowest (&lt;span class="ansi-green-fg"&gt;p=0.03783&lt;/span&gt;, mean: slowest: 0.76791, fast: 0.0492832)
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Yikes! As you can see in the plots, the &lt;code&gt;slow&lt;/code&gt; and &lt;code&gt;slowest&lt;/code&gt; algorithms run at similar speeds despite all that extra effort to implement the fancy formula.  As expected, when carefully implemented, the rank-one update method is lightning fast.&lt;/p&gt;
&lt;p&gt;I suspect that this mistake is quite common. By default, multiplication is a left-associative operation.  This case results in an unnecessary matrix-matrix product instead of an outer-product of two matrix-vector products.&lt;/p&gt;
&lt;p&gt;Looking forward, I suggest that authors put explicit parenthesis in the rank-one update formula:&lt;/p&gt;
$$
(A + u \, v^\top)^{-1} = B^{-1} - \frac{1}{1 + v^\top B\, u} \left(B\, u\right)\, \left(v^\top B\right)
$$&lt;p&gt;So, coders, please be careful when translating math into code.  Mathers, please help us coders out by putting parens in equations.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h1 id="Bonus"&gt;Bonus&lt;a class="anchor-link" href="#Bonus"&gt;&amp;#182;&lt;/a&gt;&lt;/h1&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;If you really want this method to be very fast, we can use specialized &lt;a href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms"&gt;BLAS&lt;/a&gt; routines for rank-one updates.  Thanks to 
Dr. Nikos Karampatziakis for suggesting it on &lt;a href="https://twitter.com/eigenikos/status/1375143742064062464"&gt;Twitter&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Specifically, &lt;a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.blas.dger.html"&gt;DGER&lt;/a&gt;, which computes
$$
B \gets B + \alpha \, x\, y^\top
$$&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;It looks like the &lt;code&gt;overwrite_a&lt;/code&gt; flag is &lt;a href="https://stackoverflow.com/questions/46608816/scipy-blas-routine-does-not-overwrite-input-despite-using-overwrite-a-true"&gt;busted&lt;/a&gt;.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[54]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fastest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;Bu&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;
    &lt;span class="n"&gt;alpha&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;Bu&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scipy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;linalg&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;blas&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dger&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Bu&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;overwrite_a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[55]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;faster&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;Bu&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;
    &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;Bu&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;@&lt;/span&gt; &lt;span class="n"&gt;Bu&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[56]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;arsenal&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;iterview&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timers&lt;/span&gt;
&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;timers&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;iterview&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logspace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;3.75&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
    &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ceil&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;inv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    
    &lt;span class="n"&gt;ref&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;slow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;faster&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;faster&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ref&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;fastest&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;fastest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ref&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

    &lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_subarea output_stream output_stderr output_text"&gt;
&lt;pre&gt;100.0% (10/10) [======================================================] 00:00:18
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[57]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_feature&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

    &lt;div class="prompt"&gt;&lt;/div&gt;




&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,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
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[18]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compare&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

    &lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;faster is 1.6453x faster than fast (&lt;span class="ansi-yellow-fg"&gt;p=0.23634&lt;/span&gt;, mean: fast: 0.0406869, faster: 0.0247292)
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
 


&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="misc"></category><category term="numerical"></category><category term="efficiency"></category></entry><entry><title>Gradient of a product</title><link href="https://timvieira.github.io/blog/post/2015/07/29/gradient-of-a-product/" rel="alternate"></link><published>2015-07-29T00:00:00-04:00</published><updated>2015-07-29T00:00:00-04:00</updated><author><name>Tim Vieira</name></author><id>tag:timvieira.github.io,2015-07-29:/blog/post/2015/07/29/gradient-of-a-product/</id><content type="html">&lt;div class="math"&gt;$$
\newcommand{\gradx}[1]{\grad{x}{ #1 }}
\newcommand{\grad}[2]{\nabla_{\! #1}\! \left[ #2 \right]}
\newcommand{\R}{\mathbb{R}}
\newcommand{\bigo}[0]{\mathcal{O}}
$$&lt;/div&gt;
&lt;p&gt;In this post we'll look at how to compute the gradient of a product. This is
such a common subroutine in machine learning that it's worth careful
consideration. In a later post, I'll describe the gradient of a
sum-over-products, which is another interesting and common pattern in machine
learning (e.g., exponential families, CRFs, context-free grammar, case-factor
diagrams, semiring-weighted logic programming).&lt;/p&gt;
&lt;p&gt;Given a collection of functions with a common argument &lt;span class="math"&gt;\(f_1, \cdots, f_n \in \{
\R^d \mapsto \R \}\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Define their product &lt;span class="math"&gt;\(p(x) = \prod_{i=1}^n f_i(x)\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Suppose, we'd like to compute the gradient of the product of these functions
with respect to their common argument, &lt;span class="math"&gt;\(x\)&lt;/span&gt;.&lt;/p&gt;
&lt;div class="math"&gt;$$
\begin{eqnarray*}
\gradx{ p(x) }
&amp;amp;=&amp;amp; \gradx{ \prod_{i=1}^n f_i(x) }
&amp;amp;=&amp;amp; \sum_{i=1}^n \left( \gradx{f_i(x)} \prod_{i \ne j} f_j(x)  \right)
\end{eqnarray*}
$$&lt;/div&gt;
&lt;p&gt;As you can see in the equation above, the gradient takes the form of a
"leave-one-out product" sometimes called a "cavity."&lt;/p&gt;
&lt;p&gt;A naive method for computing the gradient computes the leave-one-out products
from scratch for each &lt;span class="math"&gt;\(i\)&lt;/span&gt; (outer loop)&amp;mdash;resulting in a overall runtime of
&lt;span class="math"&gt;\(O(n^2)\)&lt;/span&gt; to compute the gradient. Later, we'll see a dynamic program for
computing this efficiently.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Division trick&lt;/strong&gt;: Before going down the dynamic programming rabbit hole, let's
consider the following relatively simple method for computing the gradient,
which uses division:&lt;/p&gt;
&lt;div class="math"&gt;$$
\begin{eqnarray*}
\gradx{ p(x) }
&amp;amp;=&amp;amp; \sum_{i=1}^n \left( \frac{\gradx{f_i(x)} }{ f_i(x) } \prod_{j=1}^n f_j(x) \right)
&amp;amp;=&amp;amp; \left( \sum_{i=1}^n \frac{\gradx{f_i(x)} }{ f_i(x) } \right) \left( \prod_{j=1}^n f_j(x) \right)
\end{eqnarray*}
$$&lt;/div&gt;
&lt;p&gt;Pro:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Runtime &lt;span class="math"&gt;\(\bigo(n)\)&lt;/span&gt; with space &lt;span class="math"&gt;\(\bigo(1)\)&lt;/span&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Con:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Requires &lt;span class="math"&gt;\(f \ne 0\)&lt;/span&gt;. No worries, we can handle zeros with three cases: (1) If
   no zeros: the division trick works fine. (2) Only one zero: implies that only
   one term in the sum will have a nonzero gradient, which we compute via
   leave-one-out product. (3) Two or more zeros: all gradients are zero and
   there is no work to be done.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Requires multiplicative inverse operator (division) &lt;em&gt;and&lt;/em&gt;
   associative-commutative multiplication, which means it's not applicable to
   matrices.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Log trick&lt;/strong&gt;: Suppose &lt;span class="math"&gt;\(f_i\)&lt;/span&gt; are very small numbers (e.g., probabilities), which
we'd rather not multiply together because we'll quickly lose precision (e.g.,
for large &lt;span class="math"&gt;\(n\)&lt;/span&gt;). It's common practice (especially in machine learning) to replace
&lt;span class="math"&gt;\(f_i\)&lt;/span&gt; with &lt;span class="math"&gt;\(\log f_i\)&lt;/span&gt;, which turns products into sums, &lt;span class="math"&gt;\(\prod_{j=1}^n f_j(x) =
\exp \left( \sum_{j=1}^n \log f_j(x) \right)\)&lt;/span&gt;, and tiny numbers (like
&lt;span class="math"&gt;\(\texttt{3.72e-44}\)&lt;/span&gt;) into large ones (like &lt;span class="math"&gt;\(\texttt{-100}\)&lt;/span&gt;).&lt;/p&gt;
&lt;p&gt;Furthermore, using the identity &lt;span class="math"&gt;\((\nabla g) = g \cdot \nabla \log g\)&lt;/span&gt;, we can
operate exclusively in the "&lt;span class="math"&gt;\(\log\)&lt;/span&gt;-domain".&lt;/p&gt;
&lt;div class="math"&gt;$$
\begin{eqnarray*}
\gradx{ p(x) }
&amp;amp;=&amp;amp; \left( \sum_{i=1}^n \gradx{ \log f_i(x) } \right) \exp\left( \sum_{j=1}^n \log f_j(x) \right)
\end{eqnarray*}
$$&lt;/div&gt;
&lt;p&gt;Pro:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Numerically stable&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Runtime &lt;span class="math"&gt;\(\bigo(n)\)&lt;/span&gt; with space &lt;span class="math"&gt;\(\bigo(1)\)&lt;/span&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Doesn't require multiplicative inverse assuming you can compute &lt;span class="math"&gt;\(\gradx{ \log
   f_i(x) }\)&lt;/span&gt; without it.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Con:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Requires &lt;span class="math"&gt;\(f &amp;gt; 0\)&lt;/span&gt;. But, we can use
   &lt;a href="http://timvieira.github.io/blog/post/2015/02/01/log-real-number-class/"&gt;LogReal number class&lt;/a&gt;
   to represent negative numbers in log-space, but we still need to be careful
   about zeros (like in the division trick).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Doesn't easily generalize to other notions of multiplication.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Dynamic programming trick&lt;/strong&gt;: &lt;span class="math"&gt;\(\bigo(n)\)&lt;/span&gt; runtime and &lt;span class="math"&gt;\(\bigo(n)\)&lt;/span&gt; space. You may
recognize this as forward-backward algorithm for linear chain CRFs
(cf. &lt;a href="http://www.inference.phy.cam.ac.uk/hmw26/papers/crf_intro.pdf"&gt;Wallach (2004)&lt;/a&gt;,
section 7).&lt;/p&gt;
&lt;p&gt;The trick is very straightforward when you think about it in isolation. Compute
the products of all prefixes and suffixes. Then, multiply them together.&lt;/p&gt;
&lt;p&gt;Here are the equations:&lt;/p&gt;
&lt;div class="math"&gt;$$
\begin{eqnarray*}
\alpha_0(x) &amp;amp;=&amp;amp; 1 \\
\alpha_t(x)
   &amp;amp;=&amp;amp; \prod_{i \le t} f_i(x)
   = \alpha_{t-1}(x) \cdot f_t(x) \\
\beta_{n+1}(x) &amp;amp;=&amp;amp; 1 \\
\beta_t(x)
  &amp;amp;=&amp;amp; \prod_{i \ge t} f_i(x) = f_t(x) \cdot \beta_{t+1}(x)\\
\gradx{ p(x) }
&amp;amp;=&amp;amp; \sum_{i=1}^n \left( \prod_{j &amp;lt; i} f_j(x) \right) \gradx{f_i(x)} \left( \prod_{j &amp;gt; i} f_j(x) \right) \\
&amp;amp;=&amp;amp; \sum_{i=1}^n \alpha_{i-1}(x) \cdot \gradx{f_i(x)} \cdot \beta_{i+1}(x)
\end{eqnarray*}
$$&lt;/div&gt;
&lt;p&gt;Clearly, this requires &lt;span class="math"&gt;\(O(n)\)&lt;/span&gt; additional space.&lt;/p&gt;
&lt;p&gt;Only requires an associative operator (i.e., Does not require it to be
commutative or invertible like earlier strategies).&lt;/p&gt;
&lt;p&gt;Why do we care about the non-commutative multiplication? A common example is
matrix multiplication where &lt;span class="math"&gt;\(A B C \ne B C A\)&lt;/span&gt;, even if all matrices have the
conformable dimensions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Connections to automatic differentiation&lt;/strong&gt;: The theory behind reverse-mode
automatic differentiation says that if you can compute a function, then you
&lt;em&gt;can&lt;/em&gt; compute it's gradient with the same asymptotic complexity, &lt;em&gt;but&lt;/em&gt; you might
need more space. That's exactly what we did here: We started with a naive
algorithm for computing the gradient with &lt;span class="math"&gt;\(\bigo(n^2)\)&lt;/span&gt; time and &lt;span class="math"&gt;\(\bigo(1)\)&lt;/span&gt; space
(other than the space to store the &lt;span class="math"&gt;\(n\)&lt;/span&gt; functions) and ended up with a &lt;span class="math"&gt;\(\bigo(n)\)&lt;/span&gt;
time &lt;span class="math"&gt;\(\bigo(n)\)&lt;/span&gt; space algorithm with a little clever thinking. What I'm saying
is autodiff&amp;mdash;even if you don't use a magical package&amp;mdash;tells us that an
efficient algorithm for the gradient always exists. Furthermore, it tells you
how to derive it manually, if you are so inclined. The key is to reuse
intermediate quantities (hence the increase in space).&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Sketch&lt;/em&gt;: In the gradient-of-a-product case, assuming we implemented
multiplication left-to-right (forward pass) that already defines the prefix
products (&lt;span class="math"&gt;\(\alpha\)&lt;/span&gt;). It turns out that the backward pass gives us &lt;span class="math"&gt;\(\beta\)&lt;/span&gt; as
adjoints. Lastly, we'd propagate gradients through the &lt;span class="math"&gt;\(f\)&lt;/span&gt;'s to get
&lt;span class="math"&gt;\(\frac{\partial p}{\partial x}\)&lt;/span&gt;. Essentially, we end up with exactly the dynamic
programming algorithm we came up with.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="misc"></category><category term="calculus"></category><category term="numerical"></category><category term="automatic-differentiation"></category><category term="datastructures"></category></entry><entry><title>Log-Real number class</title><link href="https://timvieira.github.io/blog/post/2015/02/01/log-real-number-class/" rel="alternate"></link><published>2015-02-01T00:00:00-05:00</published><updated>2015-02-01T00:00:00-05:00</updated><author><name>Tim Vieira</name></author><id>tag:timvieira.github.io,2015-02-01:/blog/post/2015/02/01/log-real-number-class/</id><content type="html">&lt;p&gt;Most people know how to avoid numerical underflow in probability computations by
representing intermediate quantities in the log-domain. This trick turns
"multiplication" into "addition", "addition" into "logsumexp", "0" into
&lt;span class="math"&gt;\(-\infty\)&lt;/span&gt; and "1" into &lt;span class="math"&gt;\(0\)&lt;/span&gt;. Most importantly, it turns really small numbers into
reasonable-size numbers.&lt;/p&gt;
&lt;p&gt;Unfortunately, without modification, this trick is limited to positive numbers
because &lt;code&gt;log&lt;/code&gt; of a negative number is &lt;code&gt;NaN&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Well, there is good news! For the cost of an extra bit, we can extend this trick
to the negative reals and furthermore, we get a bonafide ring instead of a mere
semiring.&lt;/p&gt;
&lt;p&gt;I first saw this trick in
&lt;a href="http://www.aclweb.org/anthology/D09-1005"&gt;Li and Eisner (2009)&lt;/a&gt;. The trick is
nicely summarized in Table 3 of that paper, which I've pasted below.&lt;/p&gt;
&lt;div style="text-align:center"&gt;
&lt;img src="/blog/images/logreal.png"/&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Why do I care?&lt;/strong&gt; When computing gradients (e.g., gradient of risk),
intermediate values are rarely all positive. Furthermore, we're often
multiplying small things together. I've recently found log-reals to be effective
at squeaking a bit more numerical accuracy.&lt;/p&gt;
&lt;p&gt;This trick is useful for almost all backprop computations because backprop is
essentially:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;adjoint(u) += adjoint(v) * dv/du.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The only tricky bit is lifting all &lt;code&gt;du/dv&lt;/code&gt; computations into the log-reals.&lt;/p&gt;
&lt;p&gt;Implementation:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;This trick is better suited to programming languages with structs. Using
  objects will probably in an horrible slow down and using parallel arrays to
  store the sign bit and double is probably too tedious and error prone. (Sorry
  java folks.)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Here's a &lt;a href="https://github.com/andre-martins/TurboParser/blob/master/src/util/logval.h"&gt;C++ implementation&lt;/a&gt;
  with operator overloading from Andre Martins&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Note that log-real &lt;code&gt;+=&lt;/code&gt; involves calls to &lt;code&gt;log&lt;/code&gt; and &lt;code&gt;exp&lt;/code&gt;, which will
  definitely slow your code down a bit (these functions are much slower than
  addition).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="misc"></category><category term="numerical"></category><category term="datastructures"></category></entry><entry><title>Numerically stable p-norms</title><link href="https://timvieira.github.io/blog/post/2014/11/10/numerically-stable-p-norms/" rel="alternate"></link><published>2014-11-10T00:00:00-05:00</published><updated>2014-11-10T00:00:00-05:00</updated><author><name>Tim Vieira</name></author><id>tag:timvieira.github.io,2014-11-10:/blog/post/2014/11/10/numerically-stable-p-norms/</id><content type="html">&lt;p&gt;Consider the p-norm
&lt;/p&gt;
&lt;div class="math"&gt;$$
|| \boldsymbol{x} ||_p = \left( \sum_i |x_i|^p \right)^{\frac{1}{p}}
$$&lt;/div&gt;
&lt;p&gt;In python this translates to:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;norm1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;First-pass implementation of p-norm.&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now, suppose &lt;span class="math"&gt;\(|x_i|^p\)&lt;/span&gt; causes overflow (for some &lt;span class="math"&gt;\(i\)&lt;/span&gt;). This will occur for sufficiently large &lt;span class="math"&gt;\(p\)&lt;/span&gt; or sufficiently large &lt;span class="math"&gt;\(x_i\)&lt;/span&gt;&amp;mdash;even if &lt;span class="math"&gt;\(x_i\)&lt;/span&gt; is representable (i.e., not NaN or &lt;span class="math"&gt;\(\infty\)&lt;/span&gt;).&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;big&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;1e300&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;big&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;norm1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="n"&gt;inf&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;   &lt;span class="c1"&gt;# expected: 1e+300&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This fails because we can't square &lt;code&gt;big&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;big&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="n"&gt;inf&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;A little math&lt;/h2&gt;
&lt;p&gt;There is a way to avoid overflowing because of a few large &lt;span class="math"&gt;\(x_i\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Here's a little fact about p-norms: for any &lt;span class="math"&gt;\(p\)&lt;/span&gt; and &lt;span class="math"&gt;\(\boldsymbol{x}\)&lt;/span&gt;
&lt;/p&gt;
&lt;div class="math"&gt;$$
|| \alpha \cdot \boldsymbol{x} ||_p = |\alpha| \cdot || \boldsymbol{x}   ||_p
$$&lt;/div&gt;
&lt;p&gt;We'll use the following version (harder to remember)
&lt;/p&gt;
&lt;div class="math"&gt;$$
|| \boldsymbol{x} ||_p  = |\alpha| \cdot || \boldsymbol{x} / \alpha ||_p
$$&lt;/div&gt;
&lt;p&gt;Don't believe it? Here's some algebra:
&lt;/p&gt;
&lt;div class="math"&gt;$$
\begin{eqnarray*}
|| \boldsymbol{x} ||_p
&amp;amp;=&amp;amp; \left( \sum_i |x_i|^p \right)^{\frac{1}{p}} \\
&amp;amp;=&amp;amp; \left( \sum_i \frac{|\alpha|^p}{|\alpha|^p} \cdot |x_i|^p \right)^{\frac{1}{p}} \\
&amp;amp;=&amp;amp; |\alpha| \cdot \left( \sum_i \left( \frac{|x_i| }{|\alpha|} \right)^p \right)^{\frac{1}{p}} \\
&amp;amp;=&amp;amp; |\alpha| \cdot \left( \sum_i \left| \frac{x_i }{\alpha} \right|^p \right)^{\frac{1}{p}} \\
&amp;amp;=&amp;amp; |\alpha| \cdot || \boldsymbol{x} / \alpha ||_p
\end{eqnarray*}
$$&lt;/div&gt;
&lt;h2&gt;Back to numerical stability&lt;/h2&gt;
&lt;p&gt;Suppose we pick &lt;span class="math"&gt;\(\alpha = \max_i |x_i|\)&lt;/span&gt;. Now, the largest number we have to take
the power of is one&amp;mdash;making it very difficult to overflow on the account of
&lt;span class="math"&gt;\(\boldsymbol{x}\)&lt;/span&gt;. This should remind you of the infamous log-sum-exp trick.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;robust_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;norm1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now, our example from before works :-)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;robust_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mf"&gt;1e+300&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Remarks&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;It appears as if &lt;code&gt;scipy.linalg.norm&lt;/code&gt; is robust to overflow, while &lt;code&gt;numpy.linalg.norm&lt;/code&gt; is not. Note that &lt;code&gt;scipy.linalg.norm&lt;/code&gt; appears to be a bit slower.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The &lt;code&gt;logsumexp&lt;/code&gt; trick is nearly identical, but operates in the log-domain, i.e., &lt;span class="math"&gt;\(\text{logsumexp}(\log(|x|) \cdot p) / p = \log || x ||_p\)&lt;/span&gt;. You can implement both tricks with the same code, if you use different number classes for log-domain and real-domain&amp;mdash;a trick you might have seen before.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;arsenal.math&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;logsumexp&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;abs&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;logsumexp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;
&lt;span class="mf"&gt;1.91432069824&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;robust_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="mf"&gt;1.91432069824&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="misc"></category><category term="numerical"></category></entry><entry><title>Complex-step derivative</title><link href="https://timvieira.github.io/blog/post/2014/08/07/complex-step-derivative/" rel="alternate"></link><published>2014-08-07T00:00:00-04:00</published><updated>2014-08-07T00:00:00-04:00</updated><author><name>Tim Vieira</name></author><id>tag:timvieira.github.io,2014-08-07:/blog/post/2014/08/07/complex-step-derivative/</id><content type="html">&lt;p&gt;Estimate derivatives by simply passing in a complex number to your function!&lt;/p&gt;
&lt;div class="math"&gt;$$
f'(x) \approx \frac{1}{\varepsilon} \text{Im}\Big[ f(x + i \cdot \varepsilon) \Big]
$$&lt;/div&gt;
&lt;p&gt;&lt;br/&gt;Recall, the centered-difference approximation is a fairly accurate method for
approximating derivatives of a univariate function &lt;span class="math"&gt;\(f\)&lt;/span&gt;, which only requires two
function evaluations. A similar derivation, based on the Taylor series expansion
with a complex perturbation, gives us a similarly-accurate approximation with a
single (complex) function evaluation instead of two (real-valued) function
evaluations. Note: &lt;span class="math"&gt;\(f\)&lt;/span&gt; must support complex inputs (in frameworks, such as numpy
or matlab, this often requires no modification to source code).&lt;/p&gt;
&lt;p&gt;This post is based on
&lt;a href="http://mdolab.engin.umich.edu/sites/default/files/Martins2003CSD.pdf"&gt;Martins+'03&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Derivation&lt;/strong&gt;: Start with the Taylor series approximation:&lt;/p&gt;
&lt;div class="math"&gt;$$
f(x + i \cdot \varepsilon) =
  \frac{i^0 \varepsilon^0}{0!} f(x)
+ \frac{i^1 \varepsilon^1}{1!} f'(x)
+ \frac{i^2 \varepsilon^2}{2!} f''(x)
+ \frac{i^3 \varepsilon^3}{3!} f'''(x)
+ \cdots
$$&lt;/div&gt;
&lt;p&gt;&lt;br/&gt;Take the imaginary part of both sides and solve for &lt;span class="math"&gt;\(f'(x)\)&lt;/span&gt;. Note: the &lt;span class="math"&gt;\(f\)&lt;/span&gt; and
&lt;span class="math"&gt;\(f''\)&lt;/span&gt; term disappear because &lt;span class="math"&gt;\(i^0\)&lt;/span&gt; and &lt;span class="math"&gt;\(i^2\)&lt;/span&gt; are real-valued.&lt;/p&gt;
&lt;div class="math"&gt;$$
f'(x) = \frac{1}{\varepsilon} \text{Im}\Big[ f(x + i \cdot \varepsilon) \Big] + \frac{\varepsilon^2}{3!} f'''(x) + \cdots
$$&lt;/div&gt;
&lt;p&gt;&lt;br/&gt;As usual, using a small &lt;span class="math"&gt;\(\varepsilon\)&lt;/span&gt; let's us throw out higher-order
terms. And, we arrive at the following approximation:&lt;/p&gt;
&lt;div class="math"&gt;$$
f'(x) \approx \frac{1}{\varepsilon} \text{Im}\Big[ f(x + i \cdot \varepsilon) \Big]
$$&lt;/div&gt;
&lt;p&gt;&lt;br/&gt;If instead, we take the real part and solve for &lt;span class="math"&gt;\(f(x)\)&lt;/span&gt;, we get an approximation
to the function's value at &lt;span class="math"&gt;\(x\)&lt;/span&gt;:&lt;/p&gt;
&lt;div class="math"&gt;$$
f(x) \approx \text{Re}\Big[ f(x + i \cdot \varepsilon) \Big]
$$&lt;/div&gt;
&lt;p&gt;&lt;br/&gt;In other words, a single (complex) function evaluations computes both the
function's value and the derivative.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Code&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;complex_step&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eps&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1e-10&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;    Higher-order function takes univariate function which computes a value and&lt;/span&gt;
&lt;span class="sd"&gt;    returns a function which returns value-derivative pair approximation.&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;f1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;complex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eps&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;         &lt;span class="c1"&gt;# convert input to complex number&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;real&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imag&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;eps&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c1"&gt;# return function value and gradient&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;f1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A simple test:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;cos&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;  &lt;span class="c1"&gt;# function&lt;/span&gt;
&lt;span class="n"&gt;g&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;# gradient&lt;/span&gt;
&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;1.0&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;complex_step&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;Other comments&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Using the complex-step method to estimate the gradients of multivariate
  functions requires independent approximations for each dimension of the
  input.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Although the complex-step approximation only requires a single function
  evaluation, it's unlikely faster than performing two function evaluations
  because operations on complex numbers are generally much slower than on floats
  or doubles.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Code&lt;/strong&gt;: Check out the
&lt;a href="https://gist.github.com/timvieira/3d3db3e5e78e17cdd103"&gt;gist&lt;/a&gt; for this post.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="misc"></category><category term="calculus"></category><category term="numerical"></category></entry><entry><title>Exp-normalize trick</title><link href="https://timvieira.github.io/blog/post/2014/02/11/exp-normalize-trick/" rel="alternate"></link><published>2014-02-11T00:00:00-05:00</published><updated>2014-02-11T00:00:00-05:00</updated><author><name>Tim Vieira</name></author><id>tag:timvieira.github.io,2014-02-11:/blog/post/2014/02/11/exp-normalize-trick/</id><content type="html">&lt;p&gt;This trick is the very close cousin of the infamous log-sum-exp trick
(&lt;a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.misc.logsumexp.html"&gt;scipy.misc.logsumexp&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Supposed you'd like to evaluate a probability distribution &lt;span class="math"&gt;\(\boldsymbol{\pi}\)&lt;/span&gt;
parametrized by a vector &lt;span class="math"&gt;\(\boldsymbol{x} \in \mathbb{R}^n\)&lt;/span&gt; as follows:&lt;/p&gt;
&lt;div class="math"&gt;$$
\pi_i = \frac{ \exp(x_i) }{ \sum_{j=1}^n \exp(x_j) }
$$&lt;/div&gt;
&lt;p&gt;The exp-normalize trick leverages the following identity to avoid numerical
overflow. For any &lt;span class="math"&gt;\(b \in \mathbb{R}\)&lt;/span&gt;,&lt;/p&gt;
&lt;div class="math"&gt;$$
\pi_i
= \frac{ \exp(x_i - b) \exp(b) }{ \sum_{j=1}^n \exp(x_j - b) \exp(b) }
= \frac{ \exp(x_i - b) }{ \sum_{j=1}^n \exp(x_j - b) }
$$&lt;/div&gt;
&lt;p&gt;In other words, the &lt;span class="math"&gt;\(\boldsymbol{\pi}\)&lt;/span&gt; is shift-invariant. A reasonable choice
is &lt;span class="math"&gt;\(b = \max_{i=1}^n x_i\)&lt;/span&gt;. With this choice, overflow due to &lt;span class="math"&gt;\(\exp\)&lt;/span&gt; is
impossible&lt;span class="math"&gt;\(-\)&lt;/span&gt;the largest number exponentiated after shifting is &lt;span class="math"&gt;\(0\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;The naive implementation is terrible when there are large numbers!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="ne"&gt;RuntimeWarning&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;overflow&lt;/span&gt; &lt;span class="n"&gt;encountered&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;exp&lt;/span&gt;
&lt;span class="ne"&gt;RuntimeWarning&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;invalid&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="n"&gt;encountered&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;true_divide&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt; &lt;span class="mf"&gt;0.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="mf"&gt;0.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nan&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The exp-normalize trick avoids this common problem.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;exp_normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;exp_normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mf"&gt;0.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;1.&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;Log-sum-exp for computing the log-distibution&lt;/strong&gt;&lt;/p&gt;
&lt;div class="math"&gt;$$
\log \pi_i = x_i - \mathrm{logsumexp}(\boldsymbol{x})
$$&lt;/div&gt;
&lt;p&gt;where
&lt;/p&gt;
&lt;div class="math"&gt;$$
\mathrm{logsumexp}(\boldsymbol{x}) = b + \log \sum_{j=1}^n \exp(x_j - b)
$$&lt;/div&gt;
&lt;p&gt;Typically with the same choice for &lt;span class="math"&gt;\(b\)&lt;/span&gt; as above.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Exp-normalize v. log-sum-exp&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Exp-normalize is the gradient of log-sum-exp. So you probably need to know both
tricks!&lt;/p&gt;
&lt;p&gt;If what you want to remain in log-space, that is, compute
&lt;span class="math"&gt;\(\log(\boldsymbol{\pi})\)&lt;/span&gt;, you should use logsumexp. However, if
&lt;span class="math"&gt;\(\boldsymbol{\pi}\)&lt;/span&gt; is your goal, then exp-normalize trick is for you! Since it
avoids additional calls to &lt;span class="math"&gt;\(\exp\)&lt;/span&gt;, which would be required if using log-sum-exp
and more importantly exp-normalize is more numerically stable!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Numerically stable sigmoid function&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The sigmoid function can be computed with the exp-normalize trick in order to
avoid numerical overflow. In the case of &lt;span class="math"&gt;\(\text{sigmoid}(x)\)&lt;/span&gt;, we have a
distribution with unnormalized log probabilities &lt;span class="math"&gt;\([x,0]\)&lt;/span&gt;, where we are only
interested in the probability of the first event. From the exp-normalize
identity, we know that the distributions &lt;span class="math"&gt;\([x,0]\)&lt;/span&gt; and &lt;span class="math"&gt;\([0,-x]\)&lt;/span&gt; are equivalent (to
see why, plug in &lt;span class="math"&gt;\(b=\max(0,x)\)&lt;/span&gt;). This is why sigmoid is often expressed in one
of two equivalent ways:&lt;/p&gt;
&lt;div class="math"&gt;$$
\text{sigmoid}(x) = 1/(1+\exp(-x)) = \exp(x) / (\exp(x) + 1)
$$&lt;/div&gt;
&lt;p&gt;Interestingly, each version covers an extreme case: &lt;span class="math"&gt;\(x=\infty\)&lt;/span&gt; and &lt;span class="math"&gt;\(x=-\infty\)&lt;/span&gt;,
respectively. Below is some python code which implements the trick:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sigmoid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;Numerically stable sigmoid function.&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# if x is less than zero then z will be small, denom can&amp;#39;t be&lt;/span&gt;
        &lt;span class="c1"&gt;# zero because it&amp;#39;s 1+z.&lt;/span&gt;
        &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;Closing remarks:&lt;/strong&gt; The exp-normalize distribution is also known as a
&lt;a href="https://en.wikipedia.org/wiki/Gibbs_measure"&gt;Gibbs measure&lt;/a&gt; (sometimes called a
Boltzmann distribution) when it is augmented with a temperature
parameter. Exp-normalize is often called "softmax," which is unfortunate because
log-sum-exp is &lt;em&gt;also&lt;/em&gt; called "softmax." However, unlike exp-normalize, it
&lt;em&gt;earned&lt;/em&gt; the name because it is acutally a soft version of the max function,
where as exp-normalize is closer to "soft argmax."  Nonetheless, most people
still call exp-normalize "softmax."&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="misc"></category><category term="numerical"></category></entry></feed>